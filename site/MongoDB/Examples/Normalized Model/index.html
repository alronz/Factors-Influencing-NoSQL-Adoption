<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Bilal Al-Saeedi">
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Normalized Model - Factors Influencing NoSQL Adoption</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">Factors Influencing NoSQL Adoption</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Redis <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Redis/Redis/">Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Basics/Basics/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Underline Structure/">Underline Structure</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Possible Use Cases/">Possible Use Cases</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Query Language/">Query Language</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Transaction Support/">Transaction Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Data Import and Export/">Data Import and Export</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Data Model/Data Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Data Layout/">Data Layout</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Relational Data Support/">Relational Data Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Normalization or Denormalization/">Normalization or Denormalization</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Nested Data Structures/">Nested Data Structures</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Referential Integrity/">Referential Integrity</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Query Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Query Model/Query Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Query Options/">Query Options</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Full Text Search Support/">Full Text Search Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Regular Expressions Support/">Regular Expressions Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Aggregation and Filtering/">Aggregation and Filtering</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Indexing/">Indexing</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Sorting/">Sorting</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Administration and Maintenance</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Administration and Maintenance/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Persistency/">Persistency</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Upgrading/">Upgrading</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Availability/">Availability</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Special Features/Special Features/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Scripting Support/">Scripting Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Pub and Sub Support/">Pub and Sub Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Expire Option/">Expire Option</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Redis as a Cache/">Redis as a Cache</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Examples/Examples/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Cart Management Service/">Cart Management Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Session Management Service/">Session Management Service]</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Cache Service/">Cache Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Analytics Service/">Analytics Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Job Queue System/">Job Queue System</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Handling Relational Data/">Handling Relational Data</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Bulk Transactions Support/">Bulk Transactions Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Transaction Support/">Transaction Support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Results/Results/">Main</a>
</li>

        
            
<li >
    <a href="../../../Redis/Results/Strengths and Weaknesses/">Strengths and Weaknesses</a>
</li>

        
            
<li >
    <a href="../../../Redis/Results/Summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MongoDB <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../MongoDB/">Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Basics/Basics/">Main</a>
</li>

        
            
<li >
    <a href="../../Basics/Overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../Basics/Installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../Basics/Underline Structure/">Underline Structure</a>
</li>

        
            
<li >
    <a href="../../Basics/Possible Use Cases/">Possible Use Cases</a>
</li>

        
            
<li >
    <a href="../../Basics/Query Language/">Query Language</a>
</li>

        
            
<li >
    <a href="../../Basics/Transaction Support/">Transaction Support</a>
</li>

        
            
<li >
    <a href="../../Basics/Data Import and Export/">Data Import and Export</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Data Model/Data Model/">Main</a>
</li>

        
            
<li >
    <a href="../../Data Model/Data Layout/">Data Layout</a>
</li>

        
            
<li >
    <a href="../../Data Model/Relational Data Support/">Relational Data Support</a>
</li>

        
            
<li >
    <a href="../../Data Model/Normalization or Denormalization/">Normalization or Denormalization</a>
</li>

        
            
<li >
    <a href="../../Data Model/Nested Data Structures/">Nested Data Structures</a>
</li>

        
            
<li >
    <a href="../../Data Model/Referential Integrity/">Referential Integrity</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Query Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Query Model/Query Model/">Main</a>
</li>

        
            
<li >
    <a href="../../Query Model/Query Options/">Query Options</a>
</li>

        
            
<li >
    <a href="../../Query Model/Full Text Search Support/">Full Text Search Support</a>
</li>

        
            
<li >
    <a href="../../Query Model/Regular Expressions Support/">Regular Expressions Support</a>
</li>

        
            
<li >
    <a href="../../Query Model/Aggregation and Filtering/">Aggregation and Filtering</a>
</li>

        
            
<li >
    <a href="../../Query Model/Indexing/">Indexing</a>
</li>

        
            
<li >
    <a href="../../Query Model/Sorting/">Sorting</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Administration and Maintenance</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Administration and Maintenance/Administration and Maintenance/">Main</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Persistency/">Persistency</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Upgrading/">Upgrading</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Security/">Security</a>
</li>

        
            
<li >
    <a href="../../Administration and Maintenance/Availability/">Availability</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Special Features/Special Features/">Main</a>
</li>

        
            
<li >
    <a href="../../Special Features/GridFS/">GridFS</a>
</li>

        
            
<li >
    <a href="../../Special Features/Document Validation/">Document Validation</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../Examples/">Main</a>
</li>

        
            
<li >
    <a href="../TPC-H Queries/">TPC-H Queries</a>
</li>

        
            
<li >
    <a href="../Denormalised Model/">Denormalised Model</a>
</li>

        
            
<li class="active">
    <a href="./">Normalized Model</a>
</li>

        
            
<li >
    <a href="../Mixed Model/">Mixed Model</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Results/Results/">Main</a>
</li>

        
            
<li >
    <a href="../../Results/Strengths and Weaknesses/">Strengths and Weaknesses</a>
</li>

        
            
<li >
    <a href="../../Results/Summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Neo4j <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Neo4j/Neo4j/">Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Basics/Basics/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Underline Structure/">Underline Structure</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Possible Use Cases/">Possible Use Cases</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Query Language/">Query Language</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Transaction Support/">Transaction Support</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basics/Data Import and Export/">Data Import and Export</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Data Model/Data Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Model/Data Layout/">Data Layout</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Model/Relational Data Support/">Relational Data Support</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Model/Normalization or Denormalization/">Normalization or Denormalization</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Model/Nested Data Structures/">Nested Data Structures</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Model/Referential Integrity/">Referential Integrity</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Query Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Query Model/Query Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Query Options/">Query Options</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Full Text Search Support/">Full Text Search Support</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Regular Expressions Support/">Regular Expressions Support</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Aggregation and Filtering/">Aggregation and Filtering</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Indexing/">Indexing</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Query Model/Sorting/">Sorting</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Administration and Maintenance</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Administration and Maintenance/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Persistency/">Persistency</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Upgrading/">Upgrading</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Administration and Maintenance/Availability/">Availability</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Examples/Examples/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Examples/TPC-H Queries/">TPC-H Queries</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Results/Results/">Main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Results/Strengths and Weaknesses/">Strengths and Weaknesses</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Results/Summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cassandra <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Cassandra/Cassandra/">Content</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Basics/Basics/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Underline Structure/">Underline Structure</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Possible Use Cases/">Possible Use Cases</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Query Language/">Query Language</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Transaction Support/">Transaction Support</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basics/Data Import and Export/">Data Import and Export</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Data Model/Data Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Model/Data Layout/">Data Layout</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Model/Relational Data Support/">Relational Data Support</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Model/Normalization or Denormalization/">Normalization or Denormalization</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Model/Nested Data Structures/">Nested Data Structures</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Model/Referential Integrity/">Referential Integrity</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Query Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Query Model/Query Model/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Query Options/">Query Options</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Full Text Search Support/">Full Text Search Support</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Regular Expressions Support/">Regular Expressions Support</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Aggregation and Filtering/">Aggregation and Filtering</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Indexing/">Indexing</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Query Model/Sorting/">Sorting</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Administration and Maintenance</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Administration and Maintenance/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Persistency/">Persistency</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Upgrading/">Upgrading</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Administration and Maintenance/Availability/">Availability</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Examples/Examples/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Examples/TPC-H Queries/">TPC-H Queries</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Results/Results/">Main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Results/Strengths and Weaknesses/">Strengths and Weaknesses</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Results/Summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../Denormalised Model/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Mixed Model/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="http://alronz.github.io/Factors-Influencing-NoSQL-Adoption">
                            
                            Alronz
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#mongodb-examples-normalized-model">MongoDB  &gt; Examples &gt; Normalized Model</a></li>
        
            <li><a href="#pricing-summary-report-query-q1">Pricing Summary Report Query (Q1)</a></li>
        
            <li><a href="#shipping-priority-query-q3">Shipping Priority Query (Q3)</a></li>
        
            <li><a href="#order-priority-checking-query-q4">Order Priority Checking Query (Q4)</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="mongodb-examples-normalized-model"><a href="../../MongoDB/">MongoDB </a> &gt; <a href="../Examples/">Examples</a> &gt; Normalized Model</h3>
<hr />
<p>In this model, we are fully normalising the model as we might do in relational databases. In mongoDB, we can achieve this by using object references. The order document will have references (objectIDs) to the customer and lineitems documents as shown below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/fully+normalized.png" /></p>
<p>The Order document:</p>
<pre><code class="json"> {
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;orderstatus&quot;: &quot;String&quot;,
    &quot;totalprice&quot;: &quot;Double&quot;,
    &quot;orderdate&quot;: &quot;Date&quot;,
    &quot;orderpriority&quot;: &quot;String&quot;,
    &quot;clerk&quot;: &quot;String&quot;,
    &quot;shippriority&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;customer&quot;: &quot;ObjectID&lt;Customer&gt;&quot;,
    &quot;LineItems&quot;: &quot;Array&lt;ObjectID&lt;lineitem&gt;&gt;&quot;
}
</code></pre>

<p>The Customer document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;address&quot;: &quot;String&quot;,
    &quot;phone&quot;: &quot;Double&quot;,
    &quot;acctbal&quot;: &quot;Double&quot;,
    &quot;mktsegment&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;nation&quot;: &quot;ObjectID&lt;nation&gt;&quot;
}
</code></pre>

<p>The Lineitem document :</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;quantity&quot;: &quot;Double&quot;,
    &quot;extende dprice&quot;: &quot;Double&quot;,
    &quot;discount&quot;: &quot;Double&quot;,
    &quot;tax&quot;: &quot;Double&quot;,
    &quot;returnflag&quot;: &quot;Boolean&quot;,
    &quot;linestatus&quot;: &quot;String&quot;,
    &quot;shipdate&quot;: &quot;Date&quot;,
    &quot;commitdate&quot;: &quot;Date&quot;,
    &quot;receiptdate&quot;: &quot;Date&quot;,
    &quot;shipinstruct&quot;: &quot;String&quot;,
    &quot;shipmode&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;partsupp&quot;: &quot;ObjectID&lt;partsupp&gt;&quot;
}
</code></pre>

<p>The Partsupp document :</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;availqty&quot;: &quot;Double&quot;,
    &quot;supplycost&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;part&quot;: &quot;ObjectID&lt;part&gt;&quot;,
    &quot;supplier&quot;: &quot;ObjectID&lt;supplier&gt;&quot;
}
</code></pre>

<p>The Part document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;String&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;mfgr&quot;: &quot;String&quot;,
    &quot;brand&quot;: &quot;String&quot;,
    &quot;type&quot;: &quot;String&quot;,
    &quot;size&quot;: &quot;Double&quot;,
    &quot;container&quot;: &quot;String&quot;,
    &quot;retailprice&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;
}
</code></pre>

<p>The Supplier document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;address&quot;: &quot;String&quot;,
    &quot;phone&quot;: &quot;Double&quot;,
    &quot;acctbal&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;nation&quot;: &quot;ObjectID&lt;nation&gt;&quot;
}
</code></pre>

<p>The Nation document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;region&quot;: &quot;ObjectID&lt;region&gt;&quot;
}
</code></pre>

<p>The Region document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;
}
</code></pre>

<p>A sample example for all the documents:</p>
<p>Order:</p>
<pre><code class="json"> {
    &quot;_id&quot;: &quot;7821ef4d-8e8c-46e0-950d-83c245b9bee8&quot;,
    &quot;orderstatus&quot;: &quot;Open&quot;,
    &quot;totalprice&quot;: &quot;233&quot;,
    &quot;orderdate&quot;: &quot;2015-12-21 10:51:25&quot;,
    &quot;orderpriority&quot;: &quot;High&quot;,
    &quot;clerk&quot;: &quot;John&quot;,
    &quot;shippriority&quot;: &quot;High&quot;,
    &quot;comment&quot;: &quot;This is an order&quot;,
    &quot;customer&quot;: &quot;f4005128-a7d0-11e5-bf7f-feff819cdc9f&quot;,
    &quot;LineItems&quot;: &quot;[&quot;2ddbd282-a7d1-11e5-bf7f-feff819cdc9f&quot;]&quot;
}
</code></pre>

<p>Customer:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;f4005128-a7d0-11e5-bf7f-feff819cdc9f&quot;,
    &quot;name&quot;: &quot;Bilal&quot;,
    &quot;address&quot;: &quot;Street 1&quot;,
    &quot;phone&quot;: &quot;1223456&quot;,
    &quot;acctbal&quot;: &quot;212&quot;,
    &quot;mktsegment&quot;: &quot;some text&quot;,
    &quot;comment&quot;: &quot;some text&quot;,
    &quot;nation&quot;: &quot;0aa770e6-a7d1-11e5-bf7f-feff819cdc9f&quot;
}
</code></pre>

<p>lineitem:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;2ddbd282-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;quantity&quot;: &quot;1&quot;,
    &quot;extende dprice&quot;: &quot;200&quot;,
    &quot;discount&quot;: &quot;20&quot;,
    &quot;tax&quot;: &quot;2&quot;,
    &quot;returnflag&quot;: &quot;false&quot;,
    &quot;linestatus&quot;: &quot;available&quot;,
    &quot;shipdate&quot;: &quot;2015-12-21 10:51:25&quot;,
    &quot;commitdate&quot;: &quot;2015-12-21 10:51:25&quot;,
    &quot;receiptdate&quot;: &quot;2015-12-21 10:51:25&quot;,
    &quot;shipinstruct&quot;: &quot;some text&quot;,
    &quot;shipmode&quot;: &quot;DHL&quot;,
    &quot;comment&quot;: &quot;some text&quot;,
    &quot;partsupp&quot;: &quot;62353e7e-a7d1-11e5-bf7f-feff819cdc9f&quot;
}
</code></pre>

<p>partsupp:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;62353e7e-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;availqty&quot;: &quot;20&quot;,
    &quot;supplycost&quot;: &quot;220&quot;,
    &quot;comment&quot;: &quot;some text&quot;,
    &quot;part&quot;: &quot;75f28eda-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;supplier&quot;: &quot;968a0d3a-a7d1-11e5-bf7f-feff819cdc9f&quot;
}
</code></pre>

<p>part:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;75f28eda-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;name&quot;: &quot;Tshirt&quot;,
    &quot;mfgr&quot;: &quot;Boss&quot;,
    &quot;brand&quot;: &quot;Boss&quot;,
    &quot;type&quot;: &quot;sport&quot;,
    &quot;size&quot;: &quot;40&quot;,
    &quot;container&quot;: &quot;some text&quot;,
    &quot;retailprice&quot;: &quot;230&quot;,
    &quot;comment&quot;: &quot;some text&quot;
}
</code></pre>

<p>supplier:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;968a0d3a-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;name&quot;: &quot;Boss Supplier&quot;,
    &quot;address&quot;: &quot;street 2&quot;,
    &quot;phone&quot;: &quot;212323&quot;,
    &quot;acctbal&quot;: &quot;2933&quot;,
    &quot;comment&quot;: &quot;some text&quot;,
    &quot;nation&quot;: &quot;0aa770e6-a7d1-11e5-bf7f-feff819cdc9f&quot;
}
</code></pre>

<p>nation:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;0aa770e6-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;name&quot;: &quot;US&quot;,
    &quot;comment&quot;: &quot;some text&quot;,
    &quot;region&quot;: &quot;18f228bc-a7d1-11e5-bf7f-feff819cdc9f&quot;
}
</code></pre>

<p>region:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;18f228bc-a7d1-11e5-bf7f-feff819cdc9f&quot;,
    &quot;name&quot;: &quot;Texas&quot;,
    &quot;comment&quot;: &quot;some text&quot;
}
</code></pre>

<p>In the following sections, we will show how to represent three complex TPC-H sql queries in MongoDB using this data model.</p>
<h5 id="pricing-summary-report-query-q1">Pricing Summary Report Query (Q1)</h5>
<p>This query is used to report the amount of billed, shipped and returned items. The SQL query is shown below:</p>
<pre><code>select
   l_returnflag,
   l_linestatus,
   sum(l_quantity) as sum_qty,
   sum(l_extendedprice) as sum_base_price,
   sum(l_extendedprice*(1-l_discount)) as sum_disc_price,
   sum(l_extendedprice*(1-l_discount)*(1+l_tax)) as sum_charge,
   avg(l_quantity) as avg_qty,
   avg(l_extendedprice) as avg_price,
   avg(l_discount) as avg_disc,
   count(*) as count_order
from
   lineitem
where
   l_shipdate &lt;= date '1998-12-01' - interval '[DELTA]' day (3)
group by
   l_returnflag,
   l_linestatus
order by
   l_returnflag,
   l_linestatus;
</code></pre>

<p>Since the above query needs to be run only against the lineitem table, then we can easily run the corresponding query in MongoDB agains the the lineitem collection.</p>
<p>To execute the above query in MongoDB, we will use the pipeline aggregation framework. We will divide the above query to different stages then execute them all at once. The stages that we will need are a "match" stage, a "project" stage, a "group" stage, and a "sort" stage. The "match" stage is used to get all the documents that are having the lineitem shipdate less than or equal some date value or the sql query part shown below:</p>
<pre><code>where
   l_shipdate &lt;= date '1998-12-01' - interval '[DELTA]' day (3)
</code></pre>

<p>The equivalent match stage is shown below:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;SHIPDATE&quot;:{  
         &quot;$lte&quot;:ISODate(&quot;2016-01-01T00:00:00.000Z&quot;)
      }
   }
}
</code></pre>

<p>Then we can run the project stage which will return only the attributes that we need as per the original sql query. The project stage query is shown below:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;RETURNFLAG&quot;:1,
      &quot;LINESTATUS&quot;:1,
      &quot;QUANTITY&quot;:1,
      &quot;EXTENDEDPRICE&quot;:1,
      &quot;DISCOUNT&quot;:1,
      &quot;l_dis_min_1&quot;:{  
         &quot;$subtract&quot;:[  
            1,
            &quot;$DISCOUNT&quot;
         ]
      },
      &quot;l_tax_plus_1&quot;:{  
         &quot;$add&quot;:[  
            &quot;$TAX&quot;,
            1
         ]
      }
   }
}
</code></pre>

<p>The above stage will return the attributes that we need to use in the following stages. We can also perform any required mathematical operations on any of the attributes.  Then we can perform the group stage which will group the results by certain attributes as shown below:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;RETURNFLAG&quot;:&quot;$RETURNFLAG&quot;,
         &quot;LINESTATUS&quot;:&quot;$LINESTATUS&quot;
      },
      &quot;sum_qty&quot;:{  
         &quot;$sum&quot;:&quot;$QUANTITY&quot;
      },
      &quot;sum_base_price&quot;:{  
         &quot;$sum&quot;:&quot;$EXTENDEDPRICE&quot;
      },
      &quot;sum_disc_price&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$EXTENDEDPRICE&quot;,
               &quot;$l_dis_min_1&quot;
            ]
         }
      },
      &quot;sum_charge&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$EXTENDEDPRICE&quot;,
               {  
                  &quot;$multiply&quot;:[  
                     &quot;$l_tax_plus_1&quot;,
                     &quot;$l_dis_min_1&quot;
                  ]
               }
            ]
         }
      },
      &quot;avg_price&quot;:{  
         &quot;$avg&quot;:&quot;$EXTENDEDPRICE&quot;
      },
      &quot;avg_disc&quot;:{  
         &quot;$avg&quot;:&quot;$DISCOUNT&quot;
      },
      &quot;count_order&quot;:{  
         &quot;$sum&quot;:1
      }
   }
}
</code></pre>

<p>Finally we sort the results using the sort stage as shown below:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;RETURNFLAG&quot;:1,
      &quot;LINESTATUS&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$match&quot;:{  
         &quot;SHIPDATE&quot;:{  
            &quot;$lte&quot;: ISODate(&quot;2016-01-01T00:00:00.000Z&quot;)
         }
      }
   },
   {  
      &quot;$project&quot;:{  
         &quot;RETURNFLAG&quot;:1,
         &quot;LINESTATUS&quot;:1,
         &quot;QUANTITY&quot;:1,
         &quot;EXTENDEDPRICE&quot;:1,
         &quot;DISCOUNT&quot;:1,
         &quot;l_dis_min_1&quot;:{  
            &quot;$subtract&quot;:[  
               1,
               &quot;$DISCOUNT&quot;
            ]
         },
         &quot;l_tax_plus_1&quot;:{  
            &quot;$add&quot;:[  
               &quot;$TAX&quot;,
               1
            ]
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;RETURNFLAG&quot;:&quot;$RETURNFLAG&quot;,
            &quot;LINESTATUS&quot;:&quot;$LINESTATUS&quot;
         },
         &quot;sum_qty&quot;:{  
            &quot;$sum&quot;:&quot;$QUANTITY&quot;
         },
         &quot;sum_base_price&quot;:{  
            &quot;$sum&quot;:&quot;$EXTENDEDPRICE&quot;
         },
         &quot;sum_disc_price&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$EXTENDEDPRICE&quot;,
                  &quot;$l_dis_min_1&quot;
               ]
            }
         },
         &quot;sum_charge&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$EXTENDEDPRICE&quot;,
                  {  
                     &quot;$multiply&quot;:[  
                        &quot;$l_tax_plus_1&quot;,
                        &quot;$l_dis_min_1&quot;
                     ]
                  }
               ]
            }
         },
         &quot;avg_price&quot;:{  
            &quot;$avg&quot;:&quot;$EXTENDEDPRICE&quot;
         },
         &quot;avg_disc&quot;:{  
            &quot;$avg&quot;:&quot;$DISCOUNT&quot;
         },
         &quot;count_order&quot;:{  
            &quot;$sum&quot;:1
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;RETURNFLAG&quot;:1,
         &quot;LINESTATUS&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q1 is shown below:</p>
<pre><code>    @GET
    @Path(&quot;/q1&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q1 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ1Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            String matchStringQuery = &quot;{\&quot;$match\&quot;:{\&quot;SHIPDATE\&quot;:{\&quot;$lte\&quot;:ISODate(\&quot;2016-01-01T00:00:00.000Z\&quot;)}}}&quot;;

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;RETURNFLAG\&quot;:1,\&quot;LINESTATUS\&quot;:1,\&quot;QUANTITY\&quot;:1,\&quot;EXTENDEDPRICE\&quot;:1,\&quot;DISCOUNT\&quot;:1,\&quot;l_dis_min_1\&quot;:{\&quot;$subtract\&quot;:[1,\&quot;$DISCOUNT\&quot;]},\&quot;l_tax_plus_1\&quot;:{\&quot;$add\&quot;:[\&quot;$TAX\&quot;,1]}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;RETURNFLAG\&quot;:\&quot;$RETURNFLAG\&quot;,\&quot;LINESTATUS\&quot;:\&quot;$LINESTATUS\&quot;},\&quot;sum_qty\&quot;:{\&quot;$sum\&quot;:\&quot;$QUANTITY\&quot;},\&quot;sum_base_price\&quot;:{\&quot;$sum\&quot;:\&quot;$EXTENDEDPRICE\&quot;},\&quot;sum_disc_price\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$EXTENDEDPRICE\&quot;,\&quot;$l_dis_min_1\&quot;]}},\&quot;sum_charge\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$EXTENDEDPRICE\&quot;,{\&quot;$multiply\&quot;:[\&quot;$l_tax_plus_1\&quot;,\&quot;$l_dis_min_1\&quot;]}]}},\&quot;avg_price\&quot;:{\&quot;$avg\&quot;:\&quot;$EXTENDEDPRICE\&quot;},\&quot;avg_disc\&quot;:{\&quot;$avg\&quot;:\&quot;$DISCOUNT\&quot;},\&quot;count_order\&quot;:{\&quot;$sum\&quot;:1}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;RETURNFLAG\&quot;:1,\&quot;LINESTATUS\&quot;:1}}&quot;;


            BsonDocument matchBsonQuery = BsonDocument.parse(matchStringQuery);

            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);


            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = this.normalized_lineitem.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }

</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/normalized+q1.png" /></p>
<h5 id="shipping-priority-query-q3">Shipping Priority Query (Q3)</h5>
<p>This query is used to get the 10 unshipped orders with the highest value. In order to do that, the query joins three tables (customer, order and lineitem) as shown below:</p>
<pre><code>select
 l_orderkey,
 sum(l_extendedprice*(1-l_discount)) as revenue,
 o_orderdate,
 o_shippriority
from
 customer,
 orders,
 lineitem
where
 c_mktsegment = '[SEGMENT]'
 and c_custkey = o_custkey
 and l_orderkey = o_orderkey
 and o_orderdate &lt; date '[DATE]'
 and l_shipdate &gt; date '[DATE]'
group by
 l_orderkey,
 o_orderdate,
 o_shippriority
order by
 revenue desc,
 o_orderdate;
</code></pre>

<p>Since mongoDB doesn't support joins and since the aggregation in mongoDB happens only in the collection level, then to run an aggregate query against related documents we should first fetch all the related documents and put them in a temporary collection to be able to run later aggregate query on this newly created collection. We do that by querying first the order collection and fetch all the documents that meet the condition "o_orderdate &lt; date '[DATE]'". Then for each lineitem objectID, we fetch the corresponding lineitem document and embed it inside the order document. We do the same for the customer document as shown below:</p>
<pre><code> BsonDocument bsonQuery = BsonDocument
                    .parse(&quot;{\&quot;ORDERDATE\&quot;:{\&quot;$lte\&quot;:ISODate(\&quot;2016-01-01T00:00:00.000Z\&quot;) }}&quot;);

            this.database.createCollection(&quot;normalized_q3_new_joined_orders&quot;);

            final MongoCollection&lt;Document&gt; normalized_q3_new_joined_orders = this.database
                    .getCollection(&quot;normalized_q3_new_joined_orders&quot;);

            this.normalized_order.find(bsonQuery).forEach(
                    new Block&lt;Document&gt;() {
                        @Override
                        public void apply(final Document order) {
                            BsonDocument customerBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;CUSTKEY\&quot;:\&quot;&quot;
                                            + order.get(&quot;CUSTKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;customer&quot;,
                                    normalized_customer.find(customerBsonQuery)
                                            .first());

                            BsonDocument lineitemsBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;ORDERKEY\&quot;:\&quot;&quot;
                                            + order
                                            .get(&quot;ORDERKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;lineitems&quot;, normalized_lineitem
                                    .find(lineitemsBsonQuery));

                            normalized_q3_new_joined_orders.insertOne(order);
                        }
                    });
</code></pre>

<p>Now we have a new collection called "normalized_q3_new_joined_orders" that will have all the documents needed to run the original sql aggregate query. After we run the aggregate query, we can drop the temporary collection.</p>
<p>Similar to Q1, we will divide the above query to different stages then execute them all at once using the mongoDB aggregation pipeline framework. The stages that we will need are a "match" stage, an "unwind" stage, a "project" stage, a "group" stage, and a "sort" stage. The "match" stage is used to get all the documents that corresponds to the sql query part shown below:</p>
<pre><code>where
 c_mktsegment = '[SEGMENT]'
 and c_custkey = o_custkey
 and l_orderkey = o_orderkey
 and o_orderdate &lt; date '[DATE]'
 and l_shipdate &gt; date '[DATE]'
</code></pre>

<p>Except that no need to query the join conditions since we have already represented the relationship between the different objects by embedding documents. The match stage query is shown below:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;customer.MKTSEGMENT&quot;:&quot;AUTOMOBILE&quot;,
      &quot;lineitems.SHIPDATE&quot;:{  
         &quot;$gte&quot;: ISODate(&quot;1990-01-01T00:00:00.000Z&quot;)
      }
   }
}
</code></pre>

<p>Similarly the unwind stage:</p>
<pre><code>{  
   &quot;$unwind&quot;:&quot;$lineitems&quot;
}
</code></pre>

<p>The project stage:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;ORDERDATE&quot;:1,
      &quot;SHIPPRIORITY&quot;:1,
      &quot;lineitems.EXTENDEDPRICE&quot;:1,
      &quot;l_dis_min_1&quot;:{  
         &quot;$subtract&quot;:[  
            1,
            &quot;$lineitems.DISCOUNT&quot;
         ]
      }
   }
}
</code></pre>

<p>The group stage:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;ORDERKEY&quot;:&quot;$ORDERKEY&quot;,
         &quot;ORDERDATE&quot;:&quot;$ORDERDATE&quot;,
         &quot;SHIPPRIORITY&quot;:&quot;$SHIPPRIORITY&quot;
      },
      &quot;revenue&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$lineitems.EXTENDEDPRICE&quot;,
               &quot;$l_dis_min_1&quot;
            ]
         }
      }
   }
}
</code></pre>

<p>Finally the sort stage:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;revenue&quot;:1,
      &quot;ORDERDATE&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$match&quot;:{  
         &quot;customer.MKTSEGMENT&quot;:&quot;AUTOMOBILE&quot;,
         &quot;lineitems.SHIPDATE&quot;:{  
            &quot;$gte&quot;: ISODate(&quot;1990-01-01T00:00:00.000Z&quot;)
         }
      }
   },
   {  
      &quot;$unwind&quot;:&quot;$lineitems&quot;
   },
   {  
      &quot;$project&quot;:{  
         &quot;ORDERDATE&quot;:1,
         &quot;SHIPPRIORITY&quot;:1,
         &quot;lineitems.EXTENDEDPRICE&quot;:1,
         &quot;l_dis_min_1&quot;:{  
            &quot;$subtract&quot;:[  
               1,
               &quot;$lineitems.DISCOUNT&quot;
            ]
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;ORDERKEY&quot;:&quot;$ORDERKEY&quot;,
            &quot;ORDERDATE&quot;:&quot;$ORDERDATE&quot;,
            &quot;SHIPPRIORITY&quot;:&quot;$SHIPPRIORITY&quot;
         },
         &quot;revenue&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$lineitems.EXTENDEDPRICE&quot;,
                  &quot;$l_dis_min_1&quot;
               ]
            }
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;revenue&quot;:1,
         &quot;ORDERDATE&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q3 is shown below:</p>
<pre><code>     @GET
    @Path(&quot;/q3&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q3 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ3Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            BsonDocument bsonQuery = BsonDocument
                    .parse(&quot;{\&quot;ORDERDATE\&quot;:{\&quot;$lte\&quot;:ISODate(\&quot;2016-01-01T00:00:00.000Z\&quot;) }}&quot;);

            this.database.createCollection(&quot;normalized_q3_new_joined_orders&quot;);

            final MongoCollection&lt;Document&gt; normalized_q3_new_joined_orders = this.database
                    .getCollection(&quot;normalized_q3_new_joined_orders&quot;);

            this.normalized_order.find(bsonQuery).forEach(
                    new Block&lt;Document&gt;() {
                        @Override
                        public void apply(final Document order) {
                            BsonDocument customerBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;CUSTKEY\&quot;:\&quot;&quot;
                                            + order.get(&quot;CUSTKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;customer&quot;,
                                    normalized_customer.find(customerBsonQuery)
                                            .first());

                            BsonDocument lineitemsBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;ORDERKEY\&quot;:\&quot;&quot;
                                            + order
                                            .get(&quot;ORDERKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;lineitems&quot;, normalized_lineitem
                                    .find(lineitemsBsonQuery));

                            normalized_q3_new_joined_orders.insertOne(order);
                        }
                    });

            String matchStringQuery = &quot;{\&quot;$match\&quot;:{\&quot;customer.MKTSEGMENT\&quot;:\&quot;AUTOMOBILE\&quot;,\&quot;lineitems.SHIPDATE\&quot;:{\&quot;$gte\&quot;: ISODate(\&quot;1990-01-01T00:00:00.000Z\&quot;) }}}&quot;;

            String unWindStringQuery = &quot;{$unwind: \&quot;$lineitems\&quot;}&quot;;

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;ORDERDATE\&quot;:1,\&quot;SHIPPRIORITY\&quot;:1,\&quot;lineitems.EXTENDEDPRICE\&quot;:1,\&quot;l_dis_min_1\&quot;:{\&quot;$subtract\&quot;:[1,\&quot;$lineitems.DISCOUNT\&quot;]}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;ORDERKEY\&quot;:\&quot;$ORDERKEY\&quot;,\&quot;ORDERDATE\&quot;:\&quot;$ORDERDATE\&quot;,\&quot;SHIPPRIORITY\&quot;:\&quot;$SHIPPRIORITY\&quot;},\&quot;revenue\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$lineitems.EXTENDEDPRICE\&quot;,\&quot;$l_dis_min_1\&quot;]}}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;revenue\&quot;:1,\&quot;ORDERDATE\&quot;:1}}&quot;;

            BsonDocument matchBsonQuery = BsonDocument.parse(matchStringQuery);

            BsonDocument unWindBsonQuery = BsonDocument
                    .parse(unWindStringQuery);

            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);


            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(unWindBsonQuery);
            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = normalized_q3_new_joined_orders.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            normalized_q3_new_joined_orders.drop();

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/normalized+q3.png" /></p>
<h5 id="order-priority-checking-query-q4">Order Priority Checking Query (Q4)</h5>
<p>This query is used to see how well the order priority system is working and gives indication of the customer satisfaction. The SQL query is shown below:</p>
<pre><code>select
 o_orderpriority,
 count(*) as order_count
from
 orders
where
 o_orderdate &gt;= date '[DATE]'
 and o_orderdate &lt; date '[DATE]' + interval '3' month
 and exists (
select
 *
from
 lineitem
where
 l_orderkey = o_orderkey
 and l_commitdate &lt; l_receiptdate
)
group by
 o_orderpriority
order by
 o_orderpriority;
</code></pre>

<p>Similarly since mongoDB doesn't support joins and since the aggregation in mongoDB happens only in the collection level, then to run an aggregate query against related documents we should first fetch all the related documents and put them in a temporary collection to be able to run later aggregate query on this newly created collection. We do that by querying first the order collection and fetch all the documents that meet the condition in the original sql query. Then for each lineitem objectID, we fetch the corresponding lineitem document and embed it inside the order document as shown below:</p>
<pre><code> BsonDocument bsonQuery = BsonDocument
                    .parse(&quot;{\&quot;ORDERDATE\&quot;: {\&quot;$gte\&quot;: ISODate(\&quot;1990-01-01T00:00:00.000Z\&quot;)},\&quot;ORDERDATE\&quot;: {\&quot;$lt\&quot;: ISODate(\&quot;2000-01-01T00:00:00.000Z\&quot;)}}&quot;);

            this.database.createCollection(&quot;normalized_q4_new_joined_orders&quot;);

            final MongoCollection&lt;Document&gt; normalized_q4_new_joined_orders = this.database
                    .getCollection(&quot;normalized_q4_new_joined_orders&quot;);

            this.normalized_order.find(bsonQuery).forEach(
                    new Block&lt;Document&gt;() {
                        @Override
                        public void apply(final Document order) {

                            BsonDocument lineitemsBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;ORDERKEY\&quot;:\&quot;&quot;
                                            + order
                                            .get(&quot;ORDERKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;lineitems&quot;, normalized_lineitem
                                    .find(lineitemsBsonQuery));

                            normalized_q4_new_joined_orders.insertOne(order);
                        }
                    });
</code></pre>

<p>Now we have a new collection called "normalized_q4_new_joined_orders" that will have all the documents needed to run the original sql aggregate query. After we run the aggregate query, we can drop the temporary collection.</p>
<p>Similar to Q1 and Q3, we will divide the above query to different stages then execute them all at once using the mongoDB aggregation pipeline framework. The stages we will need are  a "project" stage, a "match" stage, a "group" stage, and a "sort" stage. The "project" is used at the beginning to compare the lineitem COMMITDATE with the RECEIPTDATE and returned a 0 or 1 based on the result of the comparison. Then this value can be used in the following match stage which is shown below:</p>
<p>The first project stage:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;ORDERDATE&quot;:1,
      &quot;ORDERPRIORITY&quot;:1,
      &quot;eq&quot;:{  
         &quot;$cond&quot;:[  
            {  
               &quot;$lt&quot;:[  
                  &quot;$lineitems.COMMITDATE&quot;,
                  &quot;$lineitems.RECEIPTDATE&quot;
               ]
            },
            0,
            1
         ]
      }
   }
}
</code></pre>

<p>The following match stage:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;eq&quot;:{  
         &quot;$eq&quot;:1
      }
   }
}
</code></pre>

<p>The group stage:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;ORDERPRIORITY&quot;:&quot;$ORDERPRIORITY&quot;
      },
      &quot;order_count&quot;:{  
         &quot;$sum&quot;:1
      }
   }
}
</code></pre>

<p>Finally the sort stage:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;ORDERPRIORITY&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$project&quot;:{  
         &quot;ORDERDATE&quot;:1,
         &quot;ORDERPRIORITY&quot;:1,
         &quot;eq&quot;:{  
            &quot;$cond&quot;:[  
               {  
                  &quot;$lt&quot;:[  
                     &quot;$lineitems.COMMITDATE&quot;,
                     &quot;$lineitems.RECEIPTDATE&quot;
                  ]
               },
               0,
               1
            ]
         }
      }
   },
   {  
      &quot;$match&quot;:{  
         &quot;eq&quot;:{  
            &quot;$eq&quot;:1
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;ORDERPRIORITY&quot;:&quot;$ORDERPRIORITY&quot;
         },
         &quot;order_count&quot;:{  
            &quot;$sum&quot;:1
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;ORDERPRIORITY&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q4 is shown below:</p>
<pre><code>    @GET
    @Path(&quot;/q4&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q4 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ4Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            BsonDocument bsonQuery = BsonDocument
                    .parse(&quot;{\&quot;ORDERDATE\&quot;: {\&quot;$gte\&quot;: ISODate(\&quot;1990-01-01T00:00:00.000Z\&quot;)},\&quot;ORDERDATE\&quot;: {\&quot;$lt\&quot;: ISODate(\&quot;2000-01-01T00:00:00.000Z\&quot;)}}&quot;);

            this.database.createCollection(&quot;normalized_q4_new_joined_orders&quot;);

            final MongoCollection&lt;Document&gt; normalized_q4_new_joined_orders = this.database
                    .getCollection(&quot;normalized_q4_new_joined_orders&quot;);

            this.normalized_order.find(bsonQuery).forEach(
                    new Block&lt;Document&gt;() {
                        @Override
                        public void apply(final Document order) {

                            BsonDocument lineitemsBsonQuery = BsonDocument
                                    .parse(&quot;{\&quot;ORDERKEY\&quot;:\&quot;&quot;
                                            + order
                                            .get(&quot;ORDERKEY&quot;) + &quot;\&quot;}&quot;);

                            order.put(&quot;lineitems&quot;, normalized_lineitem
                                    .find(lineitemsBsonQuery));

                            normalized_q4_new_joined_orders.insertOne(order);
                        }
                    });

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;ORDERDATE\&quot;:1,\&quot;ORDERPRIORITY\&quot;:1,\&quot;eq\&quot;:{\&quot;$cond\&quot;:[{\&quot;$lt\&quot;:[\&quot;$lineitems.COMMITDATE\&quot;,\&quot;$lineitems.RECEIPTDATE\&quot;]},0,1]}}}&quot;;

            String matchStringQuery = &quot;{\&quot;$match\&quot;:{\&quot;eq\&quot;:{\&quot;$eq\&quot;:1}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;ORDERPRIORITY\&quot;:\&quot;$ORDERPRIORITY\&quot;},\&quot;order_count\&quot;:{\&quot;$sum\&quot;:1}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;ORDERPRIORITY\&quot;:1}}&quot;;


            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);

            BsonDocument matchBsonQuery = BsonDocument.parse(matchStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);


            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = normalized_q4_new_joined_orders.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            normalized_q4_new_joined_orders.drop();

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/normalized+q4.png" /></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright © 2016 <a href="https://sa.linkedin.com/in/bilal-al-saeedi-4b185a18">Bilal Al-Saeedi </a></p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>

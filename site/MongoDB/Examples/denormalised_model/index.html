<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Denormalised model - NoSQL Selection Factors</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">NoSQL Selection Factors</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cassandra <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Cassandra/Cassandra_Main/">Cassandra Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Adminstration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Adminstration/admin_main/">Admin main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/availability/">Availability</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/configurations/">Configurations</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/data migration/">Data migration</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/persistance/">Persistance</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Adminstration/upgrade/">Upgrade</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basic Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Basic Features/Pipline support/">Pipline support</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basic Features/basic_features_main/">Basic features main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basic Features/commands/">Commands</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basic Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Basic Features/transaction_support/">Transaction support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Modeling</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Data Modeling/data_layout/">Data layout</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/data_modeling_main/">Data modeling main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/nested_structures/">Nested structures</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/normalisation/">Normalisation</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/referential_integerity/">Referential integerity</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Data Modeling/relational_data/">Relational data</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Examples/example_main/">Example main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Examples/references/">References</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Examples/tpch/">Tpch</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Getting Started/getting_started_main/">Getting started main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Getting Started/installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Getting Started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Getting Started/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Getting Started/underline_data_structures/">Underline data structures</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Getting Started/when_to_use/">When to use</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Results/benifits_limitations/">Benifits limitations</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Results/reference/">Reference</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Results/results_main/">Results main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Results/summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Search Data</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Search Data/filtering and grouping/">Filtering and grouping</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/fulltext/">Fulltext</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/">Home</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/query/">Query</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/queryOptions/">queryOptions</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/regx/">Regx</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/search_data_main/">Search data main</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Search Data/sort/">Sort</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Cassandra/Special Features/graphgist/">Graphgist</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Special Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Cassandra/Special Features/special_features_main/">Special features main</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MongoDB <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Mongo_Main/">Mongo Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Adminstration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Adminstration/admin_main/">Admin main</a>
</li>

        
            
<li >
    <a href="../../Adminstration/availability/">Availability</a>
</li>

        
            
<li >
    <a href="../../Adminstration/backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../Adminstration/configurations/">Configurations</a>
</li>

        
            
<li >
    <a href="../../Adminstration/data migration/">Data migration</a>
</li>

        
            
<li >
    <a href="../../Adminstration/handling_failure/">Handling failure</a>
</li>

        
            
<li >
    <a href="../../Adminstration/persistance/">Persistance</a>
</li>

        
            
<li >
    <a href="../../Adminstration/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Adminstration/scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../Adminstration/security/">Security</a>
</li>

        
            
<li >
    <a href="../../Adminstration/upgrade/">Upgrade</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basic Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Basic Features/Pipline support/">Pipline support</a>
</li>

        
            
<li >
    <a href="../../Basic Features/basic_features_main/">Basic features main</a>
</li>

        
            
<li >
    <a href="../../Basic Features/commands/">Commands</a>
</li>

        
            
<li >
    <a href="../../Basic Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Basic Features/transaction_support/">Transaction support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Modeling</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Data Modeling/data_layout/">Data layout</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/data_modeling_main/">Data modeling main</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/nested_structures/">Nested structures</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/normalisation/">Normalisation</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/referential_integerity/">Referential integerity</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Data Modeling/relational_data/">Relational data</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li class="active">
    <a href="./">Denormalised model</a>
</li>

        
            
<li >
    <a href="../example_main/">Example main</a>
</li>

        
            
<li >
    <a href="../mixed_model/">Mixed model</a>
</li>

        
            
<li >
    <a href="../normalized_model/">Normalized model</a>
</li>

        
            
<li >
    <a href="../references/">References</a>
</li>

        
            
<li >
    <a href="../tpch/">Tpch</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Getting Started/getting_started_main/">Getting started main</a>
</li>

        
            
<li >
    <a href="../../Getting Started/installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../Getting Started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../Getting Started/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Getting Started/underline_data_structures/">Underline data structures</a>
</li>

        
            
<li >
    <a href="../../Getting Started/when_to_use/">When to use</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Results/results_main/">Results main</a>
</li>

        
            
<li >
    <a href="../../Results/strenghts_weaknesses/">Strenghts weaknesses</a>
</li>

        
            
<li >
    <a href="../../Results/summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Search Data</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Search Data/filtering and grouping/">Filtering and grouping</a>
</li>

        
            
<li >
    <a href="../../Search Data/fulltext/">Fulltext</a>
</li>

        
            
<li >
    <a href="../../Search Data/">Home</a>
</li>

        
            
<li >
    <a href="../../Search Data/query/">Query</a>
</li>

        
            
<li >
    <a href="../../Search Data/queryOptions/">queryOptions</a>
</li>

        
            
<li >
    <a href="../../Search Data/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Search Data/regx/">Regx</a>
</li>

        
            
<li >
    <a href="../../Search Data/search_data_main/">Search data main</a>
</li>

        
            
<li >
    <a href="../../Search Data/sort/">Sort</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../Special Features/documentValidation/">documentValidation</a>
</li>

        
            
<li >
    <a href="../../Special Features/gridFS/">gridFS</a>
</li>

        
            
<li >
    <a href="../../Special Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../Special Features/special_features_main/">Special features main</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Neo4j <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Neo4j/Neo4j_Main/">Neo4j Main</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Adminstration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Adminstration/admin_main/">Admin main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/availability/">Availability</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/configurations/">Configurations</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/data migration/">Data migration</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/persistance/">Persistance</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Adminstration/upgrade/">Upgrade</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basic Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Basic Features/Pipline support/">Pipline support</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basic Features/basic_features_main/">Basic features main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basic Features/commands/">Commands</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basic Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Basic Features/transaction_support/">Transaction support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Modeling</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Data Modeling/data_layout/">Data layout</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/data_modeling_main/">Data modeling main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/nested_structures/">Nested structures</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/normalisation/">Normalisation</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/referential_integerity/">Referential integerity</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Data Modeling/relational_data/">Relational data</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Examples/example_main/">Example main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Examples/references/">References</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Examples/tpch/">Tpch</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Getting Started/getting_started_main/">Getting started main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Getting Started/installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Getting Started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Getting Started/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Getting Started/underline_data_structures/">Underline data structures</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Getting Started/when_to_use/">When to use</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Results/results_main/">Results main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Results/strengths_weakness/">Strengths weakness</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Results/summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Search Data</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Search Data/filtering and grouping/">Filtering and grouping</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/fulltext/">Fulltext</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/">Home</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/query/">Query</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/queryOptions/">queryOptions</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/regx/">Regx</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/search_data_main/">Search data main</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Search Data/sort/">Sort</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Neo4j/Special Features/graphgist/">Graphgist</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Special Features/refernces/">Refernces</a>
</li>

        
            
<li >
    <a href="../../../Neo4j/Special Features/special_features_main/">Special features main</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Redis <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Administration and Maintenance</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Availability/">Availability</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Backup/">Backup</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Persistency/">Persistency</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Scalability/">Scalability</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Security/">Security</a>
</li>

        
            
<li >
    <a href="../../../Redis/Administration and Maintenance/Upgrading/">Upgrading</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Basics/Data Import and Export/">Data Import and Export</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Installation/">Installation</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Possible Use Cases/">Possible Use Cases</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Query Language/">Query Language</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Transaction Support/">Transaction Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Basics/Underline Structure/">Underline Structure</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Data Model/Data Layout/">Data Layout</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Nested Data Structures/">Nested Data Structures</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Normalization or Denormalization/">Normalization or Denormalization</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Referential Integrity/">Referential Integrity</a>
</li>

        
            
<li >
    <a href="../../../Redis/Data Model/Relational Data Support/">Relational Data Support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Examples/Analytics Service/">Analytics Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Bulk Transactions Support/">Bulk Transactions Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Cache Service/">Cache Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Cart Management Service/">Cart Management Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Handling Relational Data/">Handling Relational Data</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Job Queue System/">Job Queue System</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Session Management Service/">Session Management Service</a>
</li>

        
            
<li >
    <a href="../../../Redis/Examples/Transaction Support/">Transaction Support</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Query Model</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Query Model/Aggregation/">Aggregation</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Filtering/">Filtering</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Full Text Search Support/">Full Text Search Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Indexing/">Indexing</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Query Options/">Query Options</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Regular Expressions Support/">Regular Expressions Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Query Model/Sorting/">Sorting</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Results</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Results/Strengths and Weaknesses/">Strengths and Weaknesses</a>
</li>

        
            
<li >
    <a href="../../../Redis/Results/Summary/">Summary</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Special Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Redis/Special Features/Expire Option/">Expire Option</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Pub:Sub Support/">Pub:Sub Support</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Redis as a Cache/">Redis as a Cache</a>
</li>

        
            
<li >
    <a href="../../../Redis/Special Features/Scripting Support/">Scripting Support</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../../Data Modeling/relational_data/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../example_main/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#pricing-summary-report-query-q1">Pricing Summary Report Query (Q1)</a></li>
        
    
        <li class="main "><a href="#shipping-priority-query-q3">Shipping Priority Query (Q3)</a></li>
        
    
        <li class="main "><a href="#order-priority-checking-query-q4">Order Priority Checking Query (Q4)</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>In this model, we are modelling the TPC-H data model in one single document called order. The order will have all lineitems documents embedded inside it as shown below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/Denormalized.png" /></p>
<p>Order document:</p>
<pre><code class="json"> {
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;orderstatus&quot;: &quot;String&quot;,
    &quot;totalprice&quot;: &quot;Double&quot;,
    &quot;orderdate&quot;: &quot;Date&quot;,
    &quot;orderpriority&quot;: &quot;String&quot;,
    &quot;clerk&quot;: &quot;String&quot;,
    &quot;shippriority&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;customer&quot;: &quot;Object&lt;Customer&gt;&quot;,
    &quot;LineItems&quot;: &quot;Array&lt;lineitem&gt;&quot;
}
</code></pre>

<p>As shown above, the order will embed the customer as well all the lineitem documents. The customer and document will embed the nation document which will embed the region document as shown below:</p>
<p>Customer document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;address&quot;: &quot;String&quot;,
    &quot;phone&quot;: &quot;Double&quot;,
    &quot;acctbal&quot;: &quot;Double&quot;,
    &quot;mktsegment&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;nation&quot;: &quot;Object&lt;Nation&gt;&quot;
}
</code></pre>

<p>Nation document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;region&quot;: &quot;Object&lt;region&gt;&quot;
}
</code></pre>

<p>Region document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;
}
</code></pre>

<p>The order document will embed all the lineitem documents which have the below structure:</p>
<p>Lineitem document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;quantity&quot;: &quot;Double&quot;,
    &quot;extende dprice&quot;: &quot;Double&quot;,
    &quot;discount&quot;: &quot;Double&quot;,
    &quot;tax&quot;: &quot;Double&quot;,
    &quot;returnflag&quot;: &quot;Boolean&quot;,
    &quot;linestatus&quot;: &quot;String&quot;,
    &quot;shipdate&quot;: &quot;Date&quot;,
    &quot;commitdate&quot;: &quot;Date&quot;,
    &quot;receiptdate&quot;: &quot;Date&quot;,
    &quot;shipinstruct&quot;: &quot;String&quot;,
    &quot;shipmode&quot;: &quot;String&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;partsupp&quot;: &quot;Object&lt;partsupp&gt;&quot;

}
</code></pre>

<p>As seen above, the the lineitem document is embedding the partsupp document which has the below structure:</p>
<p>Partsupp document :</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;availqty&quot;: &quot;Double&quot;,
    &quot;supplycost&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;part&quot;: &quot;Object&lt;part&gt;&quot;,
    &quot;supplier&quot;: &quot;Object&lt;supplier&gt;&quot;
}
</code></pre>

<p>The partsupp document is embedding the part and supplier documents which are shown below:</p>
<p>Part document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;String&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;mfgr&quot;: &quot;String&quot;,
    &quot;brand&quot;: &quot;String&quot;,
    &quot;type&quot;: &quot;String&quot;,
    &quot;size&quot;: &quot;Double&quot;,
    &quot;container&quot;: &quot;String&quot;,
    &quot;retailprice&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;
}
</code></pre>

<p>Supplier document:</p>
<pre><code class="json">{
    &quot;_id&quot;: &quot;ObjectID&quot;,
    &quot;name&quot;: &quot;String&quot;,
    &quot;address&quot;: &quot;String&quot;,
    &quot;phone&quot;: &quot;Double&quot;,
    &quot;acctbal&quot;: &quot;Double&quot;,
    &quot;comment&quot;: &quot;String&quot;,
    &quot;nation&quot;: &quot;Object&lt;nation&gt;&quot;
}
</code></pre>

<p>As seen above, we will store the complete data model in one document called order. All relationships between the different objects in the data model are represented with embedded documents. A complete order document will be as shown below as an example:</p>
<p><code>json
{
    "_id": "7821ef4d-8e8c-46e0-950d-83c245b9bee8",
    "orderstatus": "Open",
    "totalprice": "233",
    "orderdate": "2015-12-21 10:51:25",
    "orderpriority": "High",
    "clerk": "John",
    "shippriority": "High",
    "comment": "This is an order",
    "customer": {
        "_id": "f4005128-a7d0-11e5-bf7f-feff819cdc9f",
        "name": "Bilal",
        "address": "Street 1",
        "phone": "1223456",
        "acctbal": "212",
        "mktsegment": "some text",
        "comment": "some text",
        "nation": {
            "_id": "0aa770e6-a7d1-11e5-bf7f-feff819cdc9f",
            "name": "US",
            "comment": "some text",
            "region": {
                "_id": "18f228bc-a7d1-11e5-bf7f-feff819cdc9f",
                "name": "Texas",
                "comment": "some text"
            }
        }
    },
    "LineItems": [{
        "_id": "2ddbd282-a7d1-11e5-bf7f-feff819cdc9f",
        "quantity": "1",
        "extende dprice": "200",
        "discount": "20",
        "tax": "2",
        "returnflag": "false",
        "linestatus": "available",
        "shipdate": "2015-12-21 10:51:25",
        "commitdate": "2015-12-21 10:51:25",
        "receiptdate": "2015-12-21 10:51:25",
        "shipinstruct": "some text",
        "shipmode": "DHL",
        "comment": "some text",
        "partsupp": {
            "_id": "62353e7e-a7d1-11e5-bf7f-feff819cdc9f",
            "availqty": "20",
            "supplycost": "220",
            "comment": "some text",
            "part": {
                "_id": "75f28eda-a7d1-11e5-bf7f-feff819cdc9f",
                "name": "Tshirt",
                "mfgr": "Boss",
                "brand": "Boss",
                "type": "sport",
                "size": "40",
                "container": "some text",
                "retailprice": "230",
                "comment": "some text"
            },
            "supplier": {
                "_id": "968a0d3a-a7d1-11e5-bf7f-feff819cdc9f",
                "name": "Boss Supplier",
                "address": "street 2",
                "phone": "212323",
                "acctbal": "2933",
                "comment": "some text",
                "nation": {
                    "_id": "0aa770e6-a7d1-11e5-bf7f-feff819cdc9f",
                    "name": "US",
                    "comment": "some text",
                    "region": {
                        "_id": "18f228bc-a7d1-11e5-bf7f-feff819cdc9f",
                        "name": "Texas",
                        "comment": "some text"
                    }
                }
            }
        }
    }]
 }</code></p>
<p>Since we have modelled our data in one single document, then we will just easily run queries against one mongoDB collection "the order collection".</p>
<p>In the following sections, we will show how to represent three complex TPC-H sql queries in MongoDB using this data model.</p>
<h5 id="pricing-summary-report-query-q1">Pricing Summary Report Query (Q1)</h5>
<p>This query is used to report the amount of billed, shipped and returned items. The SQL query is shown below:</p>
<pre><code>select
   l_returnflag,
   l_linestatus,
   sum(l_quantity) as sum_qty,
   sum(l_extendedprice) as sum_base_price,
   sum(l_extendedprice*(1-l_discount)) as sum_disc_price,
   sum(l_extendedprice*(1-l_discount)*(1+l_tax)) as sum_charge,
   avg(l_quantity) as avg_qty,
   avg(l_extendedprice) as avg_price,
   avg(l_discount) as avg_disc,
   count(*) as count_order
from
   lineitem
where
   l_shipdate &lt;= date '1998-12-01' - interval '[DELTA]' day (3)
group by
   l_returnflag,
   l_linestatus
order by
   l_returnflag,
   l_linestatus;
</code></pre>

<p>To execute the above query in MongoDB, we will use the pipeline aggregation framework. We will divide the above query to different stages then execute them at once. The stages that we will need are a "match" stage, an "unwind" stage, a "project" stage, a "group" stage, and a "sort" stage. The "match" stage is used to get all the documents that are having the lineitem shipdate less than or equal some date value or the sql query part shown below:</p>
<pre><code>where
   l_shipdate &lt;= date '1998-12-01' - interval '[DELTA]' day (3)
</code></pre>

<p>The equivalent match stage is shown below:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;Items&quot;:{  
         &quot;$elemMatch&quot;:{  
            &quot;SHIPDATE&quot;:{  
               &quot;$lte&quot;:ISODate(&quot;2000-01-01T00:00:00.000Z&quot;)
            }
         }
      }
   }
}
</code></pre>

<p>Then since the returned documents will contain an array of lineitem documents, we need to unwind these document so that they can be processed by the other stages. The unwind stage query is shown below:</p>
<pre><code>{  
   &quot;$unwind&quot;:&quot;$Items&quot;
}
</code></pre>

<p>After unwinding the lineitem documents, we can run the project stage which will return only the attributes that we need as per the original sql query. The project stage query is shown below:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;Items.RETURNFLAG&quot;:1,
      &quot;Items.LINESTATUS&quot;:1,
      &quot;Items.QUANTITY&quot;:1,
      &quot;Items.EXTENDEDPRICE&quot;:1,
      &quot;Items.DISCOUNT&quot;:1,
      &quot;l_dis_min_1&quot;:{  
         &quot;$subtract&quot;:[  
            1,
            &quot;$Items.DISCOUNT&quot;
         ]
      },
      &quot;l_tax_plus_1&quot;:{  
         &quot;$add&quot;:[  
            &quot;$Items.TAX&quot;,
            1
         ]
      }
   }
}
</code></pre>

<p>The above stage will return the attributes that we need to use in the following stages. We can also perform any required mathematical operations on any of the attributes.  Then we can perform the group stage which will group the results by certain attributes as shown below:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;RETURNFLAG&quot;:&quot;$Items.RETURNFLAG&quot;,
         &quot;LINESTATUS&quot;:&quot;$Items.LINESTATUS&quot;
      },
      &quot;sum_qty&quot;:{  
         &quot;$sum&quot;:&quot;$Items.QUANTITY&quot;
      },
      &quot;sum_base_price&quot;:{  
         &quot;$sum&quot;:&quot;$Items.EXTENDEDPRICE&quot;
      },
      &quot;sum_disc_price&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$Items.EXTENDEDPRICE&quot;,
               &quot;$l_dis_min_1&quot;
            ]
         }
      },
      &quot;sum_charge&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$Items.EXTENDEDPRICE&quot;,
               {  
                  &quot;$multiply&quot;:[  
                     &quot;$l_tax_plus_1&quot;,
                     &quot;$l_dis_min_1&quot;
                  ]
               }
            ]
         }
      },
      &quot;avg_price&quot;:{  
         &quot;$avg&quot;:&quot;$Items.EXTENDEDPRICE&quot;
      },
      &quot;avg_disc&quot;:{  
         &quot;$avg&quot;:&quot;$Items.DISCOUNT&quot;
      },
      &quot;count_order&quot;:{  
         &quot;$sum&quot;:1
      }
   }
}
</code></pre>

<p>Finally we sort the results using the sort stage as shown below:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;Items.RETURNFLAG&quot;:1,
      &quot;Items.LINESTATUS&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$match&quot;:{  
         &quot;Items&quot;:{  
            &quot;$elemMatch&quot;:{  
               &quot;SHIPDATE&quot;:{  
                  &quot;$lte&quot;: ISODate(&quot;2000-01-01T00:00:00.000Z&quot;)
               }
            }
         }
      }
   },
   {  
      &quot;$unwind&quot;:&quot;$Items&quot;
   },
   {  
      &quot;$project&quot;:{  
         &quot;Items.RETURNFLAG&quot;:1,
         &quot;Items.LINESTATUS&quot;:1,
         &quot;Items.QUANTITY&quot;:1,
         &quot;Items.EXTENDEDPRICE&quot;:1,
         &quot;Items.DISCOUNT&quot;:1,
         &quot;l_dis_min_1&quot;:{  
            &quot;$subtract&quot;:[  
               1,
               &quot;$Items.DISCOUNT&quot;
            ]
         },
         &quot;l_tax_plus_1&quot;:{  
            &quot;$add&quot;:[  
               &quot;$Items.TAX&quot;,
               1
            ]
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;RETURNFLAG&quot;:&quot;$Items.RETURNFLAG&quot;,
            &quot;LINESTATUS&quot;:&quot;$Items.LINESTATUS&quot;
         },
         &quot;sum_qty&quot;:{  
            &quot;$sum&quot;:&quot;$Items.QUANTITY&quot;
         },
         &quot;sum_base_price&quot;:{  
            &quot;$sum&quot;:&quot;$Items.EXTENDEDPRICE&quot;
         },
         &quot;sum_disc_price&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$Items.EXTENDEDPRICE&quot;,
                  &quot;$l_dis_min_1&quot;
               ]
            }
         },
         &quot;sum_charge&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$Items.EXTENDEDPRICE&quot;,
                  {  
                     &quot;$multiply&quot;:[  
                        &quot;$l_tax_plus_1&quot;,
                        &quot;$l_dis_min_1&quot;
                     ]
                  }
               ]
            }
         },
         &quot;avg_price&quot;:{  
            &quot;$avg&quot;:&quot;$Items.EXTENDEDPRICE&quot;
         },
         &quot;avg_disc&quot;:{  
            &quot;$avg&quot;:&quot;$Items.DISCOUNT&quot;
         },
         &quot;count_order&quot;:{  
            &quot;$sum&quot;:1
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;Items.RETURNFLAG&quot;:1,
         &quot;Items.LINESTATUS&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q1 is shown below:</p>
<pre><code>    @GET
    @Path(&quot;/q1&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q1 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ1Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            String matchStringQuery = &quot;{\&quot;$match\&quot;:{\&quot;Items\&quot;:{\&quot;$elemMatch\&quot;:{\&quot;SHIPDATE\&quot;:{\&quot;$lte\&quot;:ISODate(\&quot;2000-01-01T00:00:00.000Z\&quot;)}}}}}&quot;;

            String unWindStringQuery = &quot;{$unwind: \&quot;$Items\&quot;}&quot;;

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;Items.RETURNFLAG\&quot;:1,\&quot;Items.LINESTATUS\&quot;:1,\&quot;Items.QUANTITY\&quot;:1,\&quot;Items.EXTENDEDPRICE\&quot;:1,\&quot;Items.DISCOUNT\&quot;:1,\&quot;l_dis_min_1\&quot;:{\&quot;$subtract\&quot;:[1,\&quot;$Items.DISCOUNT\&quot;]},\&quot;l_tax_plus_1\&quot;:{\&quot;$add\&quot;:[\&quot;$Items.TAX\&quot;,1]}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;RETURNFLAG\&quot;:\&quot;$Items.RETURNFLAG\&quot;,\&quot;LINESTATUS\&quot;:\&quot;$Items.LINESTATUS\&quot;},\&quot;sum_qty\&quot;:{\&quot;$sum\&quot;:\&quot;$Items.QUANTITY\&quot;},\&quot;sum_base_price\&quot;:{\&quot;$sum\&quot;:\&quot;$Items.EXTENDEDPRICE\&quot;},\&quot;sum_disc_price\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$Items.EXTENDEDPRICE\&quot;,\&quot;$l_dis_min_1\&quot;]}},\&quot;sum_charge\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$Items.EXTENDEDPRICE\&quot;,{\&quot;$multiply\&quot;:[\&quot;$l_tax_plus_1\&quot;,\&quot;$l_dis_min_1\&quot;]}]}},\&quot;avg_price\&quot;:{\&quot;$avg\&quot;:\&quot;$Items.EXTENDEDPRICE\&quot;},\&quot;avg_disc\&quot;:{\&quot;$avg\&quot;:\&quot;$Items.DISCOUNT\&quot;},\&quot;count_order\&quot;:{\&quot;$sum\&quot;:1}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;Items.RETURNFLAG\&quot;:1,\&quot;Items.LINESTATUS\&quot;:1}}&quot;;

            BsonDocument matchBsonQuery = BsonDocument.parse(matchStringQuery);

            BsonDocument unWindBsonQuery = BsonDocument
                    .parse(unWindStringQuery);

            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);


            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(unWindBsonQuery);
            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = this.denormalized_order.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/denormalized+q1.png" /></p>
<h5 id="shipping-priority-query-q3">Shipping Priority Query (Q3)</h5>
<p>This query is used to get the 10 unshipped orders with the highest value. In order to do that, the query joins three tables (customer, order and lineitem) as shown below:</p>
<pre><code>select
 l_orderkey,
 sum(l_extendedprice*(1-l_discount)) as revenue,
 o_orderdate,
 o_shippriority
from
 customer,
 orders,
 lineitem
where
 c_mktsegment = '[SEGMENT]'
 and c_custkey = o_custkey
 and l_orderkey = o_orderkey
 and o_orderdate &lt; date '[DATE]'
 and l_shipdate &gt; date '[DATE]'
group by
 l_orderkey,
 o_orderdate,
 o_shippriority
order by
 revenue desc,
 o_orderdate;
</code></pre>

<p>Similar to Q1, we will divide the above query to different stages then execute them all at once using the mongoDB aggregation pipeline framework. The stages that we will need are also a "match" stage, an "unwind" stage, a "project" stage, a "group" stage, and a "sort" stage. The "match" stage is used to get all the documents that corresponds to the sql query part shown below:</p>
<pre><code>where
 c_mktsegment = '[SEGMENT]'
 and c_custkey = o_custkey
 and l_orderkey = o_orderkey
 and o_orderdate &lt; date '[DATE]'
 and l_shipdate &gt; date '[DATE]'
</code></pre>

<p>Except that no need to query the join conditions since we have already represented the relationship between the different objects by embedding documents. The match stage query is shown below:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;Customer.MKTSEGMENT&quot;:&quot;AUTOMOBILE&quot;,
      &quot;ORDERDATE&quot;:{  
         &quot;$lte&quot;: ISODate(&quot;2000-01-01T00:00:00.000Z&quot;)
      },
      &quot;Items.SHIPDATE&quot;:{  
         &quot;$gte&quot;: ISODate(&quot;1990-01-01T00:00:00.000Z&quot;)
      }
   }
}
</code></pre>

<p>Similarly the unwind stage:</p>
<pre><code>{  
   &quot;$unwind&quot;:&quot;$Items&quot;
}
</code></pre>

<p>The project stage:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;ORDERDATE&quot;:1,
      &quot;SHIPPRIORITY&quot;:1,
      &quot;Items.EXTENDEDPRICE&quot;:1,
      &quot;l_dis_min_1&quot;:{  
         &quot;$subtract&quot;:[  
            1,
            &quot;$Items.DISCOUNT&quot;
         ]
      }
   }
}
</code></pre>

<p>The group stage:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;ORDERKEY&quot;:&quot;$ORDERKEY&quot;,
         &quot;ORDERDATE&quot;:&quot;$ORDERDATE&quot;,
         &quot;SHIPPRIORITY&quot;:&quot;$SHIPPRIORITY&quot;
      },
      &quot;revenue&quot;:{  
         &quot;$sum&quot;:{  
            &quot;$multiply&quot;:[  
               &quot;$Items.EXTENDEDPRICE&quot;,
               &quot;$l_dis_min_1&quot;
            ]
         }
      }
   }
}
</code></pre>

<p>Finally the sort stage:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;revenue&quot;:1,
      &quot;ORDERDATE&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$match&quot;:{  
         &quot;Customer.MKTSEGMENT&quot;:&quot;AUTOMOBILE&quot;,
         &quot;ORDERDATE&quot;:{  
            &quot;$lte&quot;:  ISODate(&quot;2000-01-01T00:00:00.000Z&quot;)
         },
         &quot;Items.SHIPDATE&quot;:{  
            &quot;$gte&quot;: ISODate(&quot;1990-01-01T00:00:00.000Z&quot;)
         }
      }
   },
   {  
      &quot;$unwind&quot;:&quot;$Items&quot;
   },
   {  
      &quot;$project&quot;:{  
         &quot;ORDERDATE&quot;:1,
         &quot;SHIPPRIORITY&quot;:1,
         &quot;Items.EXTENDEDPRICE&quot;:1,
         &quot;l_dis_min_1&quot;:{  
            &quot;$subtract&quot;:[  
               1,
               &quot;$Items.DISCOUNT&quot;
            ]
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;ORDERKEY&quot;:&quot;$ORDERKEY&quot;,
            &quot;ORDERDATE&quot;:&quot;$ORDERDATE&quot;,
            &quot;SHIPPRIORITY&quot;:&quot;$SHIPPRIORITY&quot;
         },
         &quot;revenue&quot;:{  
            &quot;$sum&quot;:{  
               &quot;$multiply&quot;:[  
                  &quot;$Items.EXTENDEDPRICE&quot;,
                  &quot;$l_dis_min_1&quot;
               ]
            }
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;revenue&quot;:1,
         &quot;ORDERDATE&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q3 is shown below:</p>
<pre><code>    @GET
    @Path(&quot;/q3&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q3 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ2Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            String matchStringQuery = &quot;{\&quot;$match\&quot;:{\&quot;Customer.MKTSEGMENT\&quot;:\&quot;AUTOMOBILE\&quot;,\&quot;ORDERDATE\&quot;:{\&quot;$lte\&quot;:ISODate(\&quot;2000-01-01T00:00:00.000Z\&quot;) },\&quot;Items.SHIPDATE\&quot;:{\&quot;$gte\&quot;: ISODate(\&quot;1990-01-01T00:00:00.000Z\&quot;)}}}&quot;;

            String unWindStringQuery = &quot;{$unwind: \&quot;$Items\&quot;}&quot;;

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;ORDERDATE\&quot;:1,\&quot;SHIPPRIORITY\&quot;:1,\&quot;Items.EXTENDEDPRICE\&quot;:1,\&quot;l_dis_min_1\&quot;:{\&quot;$subtract\&quot;:[1,\&quot;$Items.DISCOUNT\&quot;]}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;ORDERKEY\&quot;:\&quot;$ORDERKEY\&quot;,\&quot;ORDERDATE\&quot;:\&quot;$ORDERDATE\&quot;,\&quot;SHIPPRIORITY\&quot;:\&quot;$SHIPPRIORITY\&quot;},\&quot;revenue\&quot;:{\&quot;$sum\&quot;:{\&quot;$multiply\&quot;:[\&quot;$Items.EXTENDEDPRICE\&quot;,\&quot;$l_dis_min_1\&quot;]}}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;revenue\&quot;:1,\&quot;ORDERDATE\&quot;:1}}&quot;;


            BsonDocument matchBsonQuery = BsonDocument.parse(matchStringQuery);

            BsonDocument unWindBsonQuery = BsonDocument
                    .parse(unWindStringQuery);

            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);

            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(unWindBsonQuery);
            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = this.denormalized_order.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/denormalized+q3.png" /></p>
<h5 id="order-priority-checking-query-q4">Order Priority Checking Query (Q4)</h5>
<p>This query is used to see how well the order priority system is working and gives indication of the customer satisfaction. The SQL query is shown below:</p>
<pre><code>select
 o_orderpriority,
 count(*) as order_count
from
 orders
where
 o_orderdate &gt;= date '[DATE]'
 and o_orderdate &lt; date '[DATE]' + interval '3' month
 and exists (
select
 *
from
 lineitem
where
 l_orderkey = o_orderkey
 and l_commitdate &lt; l_receiptdate
)
group by
 o_orderpriority
order by
 o_orderpriority;
</code></pre>

<p>Similar to Q1 and Q3, we will divide the above query to different stages then execute them all at once using the mongoDB aggregation pipeline framework. The stages we will need are  a "project" stage, a "match" stage, a "group" stage, and a "sort" stage. The "project" is used at the beginning to compare the lineitem COMMITDATE with the RECEIPTDATE and returned a 0 or 1 based on the result of the comparison. Then this value can be used in the following match stage which is shown below:</p>
<p>The first project stage:</p>
<pre><code>{  
   &quot;$project&quot;:{  
      &quot;ORDERDATE&quot;:1,
      &quot;ORDERPRIORITY&quot;:1,
      &quot;eq&quot;:{  
         &quot;$cond&quot;:[  
            {  
               &quot;$lt&quot;:[  
                  &quot;$Items.COMMITDATE&quot;,
                  &quot;$Items.RECEIPTDATE&quot;
               ]
            },
            0,
            1
         ]
      }
   }
}
</code></pre>

<p>The following match stage:</p>
<pre><code>{  
   &quot;$match&quot;:{  
      &quot;ORDERDATE&quot;:{  
         &quot;$gte&quot;:         ISODate(&quot;1990-01-01T00:00:00.000         Z&quot;)
      },
      &quot;ORDERDATE&quot;:{  
         &quot;$lt&quot;:         ISODate(&quot;2000-01-01T00:00:00.000         Z&quot;)
      },
      &quot;eq&quot;:{  
         &quot;$eq&quot;:1
      }
   }
}
</code></pre>

<p>The group stage:</p>
<pre><code>{  
   &quot;$group&quot;:{  
      &quot;_id&quot;:{  
         &quot;ORDERPRIORITY&quot;:&quot;$ORDERPRIORITY&quot;
      },
      &quot;order_count&quot;:{  
         &quot;$sum&quot;:1
      }
   }
}
</code></pre>

<p>Finally the sort stage:</p>
<pre><code>{  
   &quot;$sort&quot;:{  
      &quot;ORDERPRIORITY&quot;:1
   }
}
</code></pre>

<p>The complete query in mongoDB is shown below:</p>
<pre><code>[  
   {  
      &quot;$project&quot;:{  
         &quot;ORDERDATE&quot;:1,
         &quot;ORDERPRIORITY&quot;:1,
         &quot;eq&quot;:{  
            &quot;$cond&quot;:[  
               {  
                  &quot;$lt&quot;:[  
                     &quot;$Items.COMMITDATE&quot;,
                     &quot;$Items.RECEIPTDATE&quot;
                  ]
               },
               0,
               1
            ]
         }
      }
   },
,
   {  
      &quot;$match&quot;:{  
         &quot;ORDERDATE&quot;:{  
            &quot;$gte&quot;: ISODate(&quot;1990-01-01T00:00:00.000Z&quot;)
         },
         &quot;ORDERDATE&quot;:{  
            &quot;$lt&quot;: ISODate(&quot;2000-01-01T00:00:00.000Z&quot;)
         },
         &quot;eq&quot;:{  
            &quot;$eq&quot;:1
         }
      }
   },
   {  
      &quot;$group&quot;:{  
         &quot;_id&quot;:{  
            &quot;ORDERPRIORITY&quot;:&quot;$ORDERPRIORITY&quot;
         },
         &quot;order_count&quot;:{  
            &quot;$sum&quot;:1
         }
      }
   },
   {  
      &quot;$sort&quot;:{  
         &quot;ORDERPRIORITY&quot;:1
      }
   }
]
</code></pre>

<p>The complete java code for the api that will return the results of TPCH Q4 is shown below:</p>
<pre><code>    @GET
    @Path(&quot;/q4&quot;)
    @Timed
    @ApiOperation(value = &quot;get result of TPCH Q4 using this model&quot;, notes = &quot;Returns mongoDB document(s)&quot;, response = Document.class, responseContainer = &quot;list&quot;)
    @ApiResponses(value = {@ApiResponse(code = 500, message = &quot;internal server error !&quot;)})
    public ArrayList&lt;Document&gt; getQ3Results() {

        AggregateIterable&lt;Document&gt; result;

        try {

            String projectStringQuery = &quot;{\&quot;$project\&quot;:{\&quot;ORDERDATE\&quot;:1,\&quot;ORDERPRIORITY\&quot;:1,\&quot;eq\&quot;:{\&quot;$cond\&quot;:[{\&quot;$lt\&quot;:[\&quot;$Items.COMMITDATE\&quot;,\&quot;$Items.RECEIPTDATE\&quot;]},0,1]}}}&quot;;

            String matchStringQuery = &quot;{\&quot;$match\&quot;: {\&quot;ORDERDATE\&quot;: {\&quot;$gte\&quot;: ISODate(\&quot;1990-01-01T00:00:00.000Z\&quot;)},\&quot;ORDERDATE\&quot;: {\&quot;$lt\&quot;: ISODate(\&quot;2000-01-01T00:00:00.000Z\&quot;)},\&quot;eq\&quot;:{\&quot;$eq\&quot;:1}}}&quot;;

            String groupStringQuery = &quot;{\&quot;$group\&quot;:{\&quot;_id\&quot;:{\&quot;ORDERPRIORITY\&quot;:\&quot;$ORDERPRIORITY\&quot;},\&quot;order_count\&quot;:{\&quot;$sum\&quot;:1}}}&quot;;

            String sortStringQuery = &quot;{\&quot;$sort\&quot;:{\&quot;ORDERPRIORITY\&quot;:1}}&quot;;


            BsonDocument projectBsonQuery = BsonDocument
                    .parse(projectStringQuery);


            BsonDocument matchBsonQuery = BsonDocument
                    .parse(matchStringQuery);

            BsonDocument groupBsonQuery = BsonDocument.parse(groupStringQuery);

            BsonDocument sortBsonQuery = BsonDocument.parse(sortStringQuery);


            ArrayList&lt;Bson&gt; aggregateQuery = new ArrayList&lt;Bson&gt;();

            aggregateQuery.add(projectBsonQuery);
            aggregateQuery.add(matchBsonQuery);
            aggregateQuery.add(groupBsonQuery);
            aggregateQuery.add(sortBsonQuery);

            result = this.denormalized_order.aggregate(aggregateQuery);

            MongoCursor&lt;Document&gt; iterator = result.iterator();

            ArrayList&lt;Document&gt; results = new ArrayList&lt;Document&gt;();
            while (iterator.hasNext()) {
                Document resultDoc = iterator.next();
                results.add(resultDoc);
            }

            return results;
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE,
                    &quot;internal server error !&quot; + e.getLocalizedMessage());
            final String shortReason = &quot;internal server error !&quot;;
            Exception cause = new IllegalArgumentException(shortReason);
            throw new WebApplicationException(cause,
                    javax.ws.rs.core.Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
</code></pre>

<p>If you call the above query, you will get the results below:</p>
<p><img alt="image" src="https://s3.amazonaws.com/b2cbucket/denormalized+q4.png" /></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
